<!DOCTYPE html> 
<html lang="es"> 
<head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Ranking ELO Super Tres-en-raya</title> 
  <script src="https://cdn.tailwindcss.com"></script> 
  <style> 
    @keyframes fadeInUp { 
      from { 
        opacity: 0; 
        transform: translateY(20px); 
      } 
      to { 
        opacity: 1; 
        transform: translateY(0); 
      } 
    } 
     
    @keyframes fadeIn { 
      from { 
        opacity: 0; 
      } 
      to { 
        opacity: 1; 
      } 
    } 
     
    .animate-fade-in-up { 
      animation: fadeInUp 0.5s ease-out forwards; 
    } 
     
    .animate-fade-in { 
      animation: fadeIn 0.4s ease-out forwards; 
    } 
     
    .stagger-1 { animation-delay: 0.05s; } 
    .stagger-2 { animation-delay: 0.1s; } 
    .stagger-3 { animation-delay: 0.15s; } 
    .stagger-4 { animation-delay: 0.2s; } 
    .stagger-5 { animation-delay: 0.25s; } 
    .stagger-6 { animation-delay: 0.3s; } 
    .stagger-7 { animation-delay: 0.35s; } 
    .stagger-8 { animation-delay: 0.4s; } 
    .stagger-9 { animation-delay: 0.45s; } 
     
    tbody tr { 
      opacity: 0; 
    } 
  </style> 
</head> 
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50"> 
  <div class="max-w-6xl mx-auto p-4 md:p-8"> 
    <!-- Header --> 
    <div class="text-center mb-8"> 
      <div class="flex items-center justify-center gap-3 mb-4"> 
        <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent"> 
          Ranking ELO 
        </h1> 
      </div> 
      <p class="text-xl text-gray-600 font-semibold">Super Tres-en-Raya</p> 
       
      <a href="https://poque-creator.github.io/Super-Tres-En-Raya/" target="_blank" rel="noopener noreferrer" 
         class="inline-flex items-center gap-2 mt-4 px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all shadow-lg hover:shadow-xl transform hover:scale-105"> 
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"> 
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path> 
        </svg> 
        Jugar Ahora 
      </a> 
    </div> 
 
    <!-- Tabs --> 
    <div class="flex gap-4 mb-6 justify-center flex-wrap"> 
      <button onclick="changeTab('ranking')" id="tab-ranking" 
              class="flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all bg-blue-600 text-white shadow-lg"> 
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"> 
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path> 
        </svg> 
        Ranking 
      </button> 
      <button onclick="changeTab('matches')" id="tab-matches" 
              class="flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all bg-white text-gray-700 hover:bg-gray-100"> 
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"> 
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path> 
        </svg> 
        Partidos 
      </button> 
      <button onclick="changeTab('stats')" id="tab-stats" 
              class="flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all bg-white text-gray-700 hover:bg-gray-100"> 
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"> 
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path> 
        </svg> 
        Estadísticas 
      </button>
      <button onclick="changeTab('h2h')" id="tab-h2h" 
              class="flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all bg-white text-gray-700 hover:bg-gray-100"> 
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"> 
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path> 
        </svg> 
        Cara a Cara 
      </button>
      <button onclick="changeTab('history')" id="tab-history" 
              class="flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all bg-white text-gray-700 hover:bg-gray-100"> 
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"> 
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path> 
        </svg> 
        Histórico 
      </button>
    </div> 
 
    <!-- Ranking Tab --> 
    <div id="content-ranking" class="block animate-fade-in"> 
      <div class="bg-white rounded-2xl shadow-2xl overflow-hidden"> 
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 p-6"> 
          <h2 class="text-2xl font-bold text-white flex items-center gap-2"> 
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"> 
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path> 
            </svg> 
            Clasificación 
          </h2> 
        </div> 
         
        <!-- Filtros --> 
        <div class="p-6 bg-gray-50 border-b border-gray-200"> 
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4"> 
            <div> 
              <label class="block text-sm font-semibold text-gray-700 mb-2"> 
                Partidos Mínimos: <span id="min-games-value">0</span> 
              </label> 
              <input type="range" min="0" max="10" value="0" id="min-games-filter" oninput="updateFilters()" 
                     class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"> 
            </div> 
             
            <div class="flex items-end"> 
              <label class="flex items-center gap-2 cursor-pointer"> 
                <input type="checkbox" id="active-only-filter" onchange="updateFilters()" 
                       class="w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"> 
                <span class="text-sm font-semibold text-gray-700">Solo jugadores activos</span> 
              </label> 
            </div> 
          </div> 
           
          <div class="mt-4 text-sm text-gray-600"> 
            Mostrando <span class="font-bold text-blue-600" id="filtered-count">0</span> de <span id="total-count">0</span> jugadores 
          </div> 
        </div> 
         
        <div class="overflow-x-auto"> 
          <table class="w-full"> 
            <thead class="bg-blue-100"> 
              <tr> 
                <th class="px-6 py-4 text-left font-bold text-blue-900">Top</th> 
                <th class="px-6 py-4 text-left font-bold text-blue-900 cursor-pointer hover:bg-blue-200 transition-colors" onclick="sortTable('name')"> 
                  Jugador <span id="sort-name"></span> 
                </th> 
                <th class="px-6 py-4 text-center font-bold text-blue-900 cursor-pointer hover:bg-blue-200 transition-colors" onclick="sortTable('elo')"> 
                  ELO <span id="sort-elo"></span> 
                </th> 
                <th class="px-6 py-4 text-center font-bold text-blue-900 cursor-pointer hover:bg-blue-200 transition-colors" onclick="sortTable('played')"> 
                  Jugados <span id="sort-played"></span> 
                </th> 
                <th class="px-6 py-4 text-center font-bold text-blue-900 cursor-pointer hover:bg-blue-200 transition-colors" onclick="sortTable('w')"> 
                  V <span id="sort-w"></span> 
                </th> 
                <th class="px-6 py-4 text-center font-bold text-blue-900 cursor-pointer hover:bg-blue-200 transition-colors" onclick="sortTable('d')"> 
                  E <span id="sort-d"></span> 
                </th> 
                <th class="px-6 py-4 text-center font-bold text-blue-900 cursor-pointer hover:bg-blue-200 transition-colors" onclick="sortTable('l')"> 
                  D <span id="sort-l"></span> 
                </th> 
                <th class="px-6 py-4 text-center font-bold text-blue-900 cursor-pointer hover:bg-blue-200 transition-colors" onclick="sortTable('winrate')"> 
                  % Victorias <span id="sort-winrate"></span> 
                </th> 
              </tr> 
            </thead> 
            <tbody id="players-table"></tbody> 
          </table> 
        </div> 
      </div> 
    </div> 
 
    <!-- Matches Tab --> 
    <div id="content-matches" class="hidden"> 
      <div class="bg-white rounded-2xl shadow-2xl p-6"> 
        <div class="flex items-center gap-2 mb-6"> 
          <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"> 
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path> 
          </svg> 
          <h2 class="text-2xl font-bold text-gray-800">Historial de Partidos</h2> 
        </div> 
        <div class="space-y-3" id="matches-list"></div> 
      </div> 
    </div> 
 
    <!-- Stats Tab --> 
    <div id="content-stats" class="hidden"> 
      <div class="bg-white rounded-2xl shadow-2xl p-6"> 
        <div class="flex items-center gap-2 mb-6"> 
          <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"> 
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path> 
          </svg> 
          <h2 class="text-2xl font-bold text-gray-800">Estadísticas Generales</h2> 
        </div> 
         
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6"> 
          <div class="bg-gradient-to-br from-blue-100 to-blue-200 p-6 rounded-xl"> 
            <p class="text-gray-700 font-semibold mb-2">Total Jugadores</p> 
            <p class="text-4xl font-bold text-blue-700" id="stats-total-players">0</p> 
          </div> 
           
          <div class="bg-gradient-to-br from-green-100 to-green-200 p-6 rounded-xl"> 
            <p class="text-gray-700 font-semibold mb-2">Partidos Jugados</p> 
            <p class="text-4xl font-bold text-green-700" id="stats-total-matches">0</p> 
          </div> 
        </div> 
 
        <div class="mt-8"> 
          <h3 class="text-xl font-bold text-gray-800 mb-4">Top 3 Jugadores</h3> 
          <div class="space-y-3" id="top3-list"></div> 
        </div> 
      </div> 
    </div>

    <!-- Head to Head Tab --> 
    <div id="content-h2h" class="hidden"> 
      <div class="bg-white rounded-2xl shadow-2xl p-6"> 
        <div class="flex items-center gap-2 mb-6"> 
          <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"> 
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path> 
          </svg> 
          <h2 class="text-2xl font-bold text-gray-800">Cara a Cara</h2> 
        </div>

        <!-- Selectores de Jugadores -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Jugador 1</label>
            <select id="h2h-player1" onchange="updateH2H()" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all">
              <option value="">Selecciona un jugador</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Jugador 2</label>
            <select id="h2h-player2" onchange="updateH2H()" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all">
              <option value="">Selecciona un jugador</option>
            </select>
          </div>
        </div>

        <!-- Resultados -->
        <div id="h2h-results"></div>
      </div> 
    </div>

    <!-- Historical Ranking Tab -->
    <div id="content-history" class="hidden">
      <div class="bg-white rounded-2xl shadow-2xl p-6">
        <div class="flex items-center gap-2 mb-6">
          <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <h2 class="text-2xl font-bold text-gray-800">Ranking Histórico</h2>
        </div>

        <div class="mb-6 bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-xl border-2 border-indigo-200">
          <label class="block text-sm font-semibold text-gray-700 mb-3">
            Ver ranking después del partido: <span id="history-match-number" class="text-indigo-600 text-lg">1</span> / <span id="history-total-matches">0</span>
          </label>
          <input type="range" min="1" max="1" value="1" id="history-slider" 
                 oninput="updateHistoricalRanking()" 
                 class="w-full h-3 bg-gradient-to-r from-indigo-200 to-purple-200 rounded-lg appearance-none cursor-pointer">
          
          <div class="mt-4 text-sm text-gray-600" id="history-match-info"></div>
        </div>

        <div class="bg-white rounded-xl border-2 border-gray-200 overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-indigo-100">
                <tr>
                  <th class="px-6 py-4 text-left font-bold text-indigo-900">Top</th>
                  <th class="px-6 py-4 text-left font-bold text-indigo-900">Jugador</th>
                  <th class="px-6 py-4 text-center font-bold text-indigo-900">ELO</th>
                  <th class="px-6 py-4 text-center font-bold text-indigo-900">Jugados</th>
                  <th class="px-6 py-4 text-center font-bold text-indigo-900">V</th>
                  <th class="px-6 py-4 text-center font-bold text-indigo-900">E</th>
                  <th class="px-6 py-4 text-center font-bold text-indigo-900">D</th>
                  <th class="px-6 py-4 text-center font-bold text-indigo-900">% Victorias</th>
                </tr>
              </thead>
              <tbody id="history-table"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
 
    <!-- Footer --> 
    <footer class="text-center mt-8 text-gray-600"> 
      <p class="font-semibold">Hugo &gt; Jhona</p> 
    </footer> 
  </div> 
 
  <script> 
    // Lista inicial de jugadores
    const initialPlayers = [
      'Jose', 'Jhonatan', 'Samuel', 'Hugo', 'Victor', 
      'Ouxiang', 'Andrei', 'Josias', 'Jose Ignacio de Economía'
    ];

    // Partidos: cada partido modifica automáticamente las estadísticas
    // Formato: { player1: 'nombre', player2: 'nombre', result: 'win1'|'win2'|'draw', elo1: +/-X, elo2: +/-X }
    const matches = [
      { player1: 'Hugo', player2: 'Ouxiang', result: 'win1', elo1: 10, elo2: 0 },
      { player1: 'Jhonatan', player2: 'Samuel', result: 'win1', elo1: 10, elo2: 0 },
      { player1: 'Victor', player2: 'Jose', result: 'win2', elo1: 0, elo2: 10 },
      { player1: 'Hugo', player2: 'Jhonatan', result: 'win1', elo1: 5, elo2: -3 },
      { player1: 'Victor', player2: 'Ouxiang', result: 'win1', elo1: 9, elo2: 0 },
      { player1: 'Jose', player2: 'Jhonatan', result: 'win1', elo1: 2, elo2: -1 },
      { player1: 'Hugo', player2: 'Victor', result: 'win2', elo1: -4, elo2: 4 }
    ];

    // Calcular estadísticas de jugadores basándose en los partidos
    function calculatePlayerStats() {
      const players = {};
      
      // Inicializar jugadores
      initialPlayers.forEach(name => {
        players[name] = { name, elo: 0, w: 0, d: 0, l: 0 };
      });
      
      // Procesar cada partido
      matches.forEach(match => {
        const { player1, player2, result, elo1, elo2 } = match;
        
        // Asegurar que los jugadores existen
        if (!players[player1]) players[player1] = { name: player1, elo: 0, w: 0, d: 0, l: 0 };
        if (!players[player2]) players[player2] = { name: player2, elo: 0, w: 0, d: 0, l: 0 };
        
        // Aplicar cambios de ELO
        players[player1].elo += elo1;
        players[player2].elo += elo2;
        
        // Actualizar victorias/empates/derrotas
        if (result === 'win1') {
          players[player1].w++;
          players[player2].l++;
        } else if (result === 'win2') {
          players[player1].l++;
          players[player2].w++;
        } else if (result === 'draw') {
          players[player1].d++;
          players[player2].d++;
        }
      });
      
      return Object.values(players);
    }

    const players = calculatePlayerStats();
 
    let currentSort = { key: 'elo', direction: 'desc' }; 
 
    function changeTab(tab) { 
      ['ranking', 'matches', 'stats', 'h2h', 'history'].forEach(t => { 
        const content = document.getElementById('content-' + t); 
        const tabBtn = document.getElementById('tab-' + t); 
         
        if (t === tab) { 
          content.classList.remove('hidden'); 
          content.classList.add('block', 'animate-fade-in'); 
          tabBtn.className = 'flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all bg-blue-600 text-white shadow-lg'; 
           
          // Re-trigger animation 
          setTimeout(() => { 
            content.classList.remove('animate-fade-in'); 
            void content.offsetWidth; // Force reflow 
            content.classList.add('animate-fade-in'); 
          }, 10); 
        } else { 
          content.classList.remove('block', 'animate-fade-in'); 
          content.classList.add('hidden'); 
          tabBtn.className = 'flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all bg-white text-gray-700 hover:bg-gray-100'; 
        } 
      }); 
    } 
 
    function sortTable(key) { 
      if (currentSort.key === key) { 
        currentSort.direction = currentSort.direction === 'desc' ? 'asc' : 'desc'; 
      } else { 
        currentSort.key = key; 
        currentSort.direction = 'desc'; 
      } 
      renderTable(); 
    } 
 
    function updateFilters() { 
      document.getElementById('min-games-value').textContent = document.getElementById('min-games-filter').value; 
      renderTable(); 
    } 
 
    function getRankColor(rank) { 
      if (rank === 1) return 'bg-gradient-to-r from-yellow-200 to-yellow-300'; 
      if (rank === 2) return 'bg-gradient-to-r from-gray-200 to-gray-300'; 
      if (rank === 3) return 'bg-gradient-to-r from-orange-200 to-orange-300'; 
      return 'bg-white hover:bg-blue-50'; 
    } 
 
    function renderTable() { 
      const minGames = parseInt(document.getElementById('min-games-filter').value); 
      const activeOnly = document.getElementById('active-only-filter').checked; 
 
      let filtered = players.map(p => { 
        const played = p.w + p.d + p.l; 
        const winrate = played > 0 ? ((p.w / played) * 100).toFixed(1) : 0; 
        return {...p, played, winrate: parseFloat(winrate)}; 
      }) 
        .filter(p => p.played >= minGames && (!activeOnly || p.played > 0)); 
 
      filtered.sort((a, b) => { 
        let aVal = a[currentSort.key]; 
        let bVal = b[currentSort.key]; 
         
        if (currentSort.key === 'name') { 
          return currentSort.direction === 'asc'  
            ? aVal.localeCompare(bVal) 
            : bVal.localeCompare(aVal); 
        } 
         
        return currentSort.direction === 'asc' ? aVal - bVal : bVal - aVal; 
      }); 
 
      document.getElementById('filtered-count').textContent = filtered.length; 
      document.getElementById('total-count').textContent = players.length;
 
      ['name', 'elo', 'played', 'w', 'd', 'l', 'winrate'].forEach(k => { 
        document.getElementById('sort-' + k).innerHTML = ''; 
      }); 
 
      const icon = currentSort.direction === 'asc'  
        ? '<svg class="w-4 h-4 inline ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>' 
        : '<svg class="w-4 h-4 inline ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>'; 
      document.getElementById('sort-' + currentSort.key).innerHTML = icon; 
 
      const tbody = document.getElementById('players-table'); 
      tbody.innerHTML = filtered.map((p, i) => ` 
        <tr class="${getRankColor(i + 1)} transition-colors border-b border-gray-200 animate-fade-in-up stagger-${Math.min(i + 1, 9)}"> 
          <td class="px-6 py-4 font-bold text-gray-800">${i + 1}</td> 
          <td class="px-6 py-4 font-semibold text-gray-800">${p.name}</td> 
          <td class="px-6 py-4 text-center"> 
            <span class="inline-block bg-blue-600 text-white px-3 py-1 rounded-full font-bold">${p.elo}</span> 
          </td> 
          <td class="px-6 py-4 text-center text-gray-700">${p.played}</td> 
          <td class="px-6 py-4 text-center"><span class="text-green-600 font-bold">${p.w}</span></td> 
          <td class="px-6 py-4 text-center"><span class="text-yellow-600 font-bold">${p.d}</span></td> 
          <td class="px-6 py-4 text-center"><span class="text-red-600 font-bold">${p.l}</span></td> 
          <td class="px-6 py-4 text-center"> 
            <span class="font-bold ${p.winrate >= 66.7 ? 'text-green-600' : p.winrate >= 33.3 ? 'text-yellow-600' : 'text-red-600'}"> 
              ${p.winrate}% 
            </span> 
          </td> 
        </tr> 
      `).join(''); 
    } 
 
    function renderMatches() {
      document.getElementById('matches-list').innerHTML = matches.map((m, i) => {
        let resultText = '';
        let winnerName = '';
        
        if (m.result === 'win1') {
          winnerName = m.player1;
          resultText = `Victoria ${m.player1}`;
        } else if (m.result === 'win2') {
          winnerName = m.player2;
          resultText = `Victoria ${m.player2}`;
        } else {
          resultText = 'Empate';
        }
        
        const elo1Text = m.elo1 > 0 ? `+${m.elo1}` : `${m.elo1}`;
        const elo2Text = m.elo2 > 0 ? `+${m.elo2}` : `${m.elo2}`;
        
        return `
        <div class="flex items-center gap-4 p-4 bg-gradient-to-r from-gray-50 to-blue-50 rounded-xl border border-gray-200 hover:shadow-md transition-shadow animate-fade-in-up stagger-${Math.min(i + 1, 9)}">
          <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">
            ${i + 1}
          </div>
          <p class="text-gray-700">
            <span class="${m.result === 'win1' ? 'font-bold text-green-600' : ''}">${m.player1}</span>
            vs
            <span class="${m.result === 'win2' ? 'font-bold text-green-600' : ''}">${m.player2}</span>
            - ${resultText}
            <span class="text-sm text-gray-600">(${m.player1}: ${elo1Text} ELO, ${m.player2}: ${elo2Text} ELO)</span>
          </p>
        </div>
        `;
      }).join('');
    }

    function renderTop3() { 
      const top3 = [...players].sort((a, b) => b.elo - a.elo).slice(0, 3); 
      document.getElementById('top3-list').innerHTML = top3.map((p, i) => ` 
        <div class="p-4 rounded-xl ${getRankColor(i + 1)} border-2 border-gray-300 animate-fade-in-up stagger-${i + 1}"> 
          <div class="flex items-center justify-between"> 
            <div class="flex items-center gap-3"> 
              <span class="text-2xl font-bold text-gray-700">#${i + 1}</span> 
              <span class="font-bold text-gray-800">${p.name}</span> 
            </div> 
      
            <div class="text-right"> 
              <p class="text-2xl font-bold text-blue-700">${p.elo} ELO</p> 
              <p class="text-sm text-gray-600">${p.w}V - ${p.d}E - ${p.l}D</p> 
            </div> 
          </div> 
        </div> 
      `).join(''); 
    }

    function updateStats() {
      document.getElementById('stats-total-players').textContent = players.length;
      document.getElementById('stats-total-matches').textContent = matches.length;
    }

    function initH2H() {
      const player1Select = document.getElementById('h2h-player1');
      const player2Select = document.getElementById('h2h-player2');
      
      const sortedPlayers = [...players].sort((a, b) => a.name.localeCompare(b.name));
      
      sortedPlayers.forEach(p => {
        const option1 = document.createElement('option');
        option1.value = p.name;
        option1.textContent = p.name;
        player1Select.appendChild(option1);
        
        const option2 = document.createElement('option');
        option2.value = p.name;
        option2.textContent = p.name;
        player2Select.appendChild(option2);
      });
    }

    function updateH2H() {
      const player1 = document.getElementById('h2h-player1').value;
      const player2 = document.getElementById('h2h-player2').value;
      const resultsDiv = document.getElementById('h2h-results');

      if (!player1 || !player2) {
        resultsDiv.innerHTML = '<p class="text-center text-gray-500 py-8">Selecciona dos jugadores para ver sus estadísticas cara a cara</p>';
        return;
      }

      if (player1 === player2) {
        resultsDiv.innerHTML = '<p class="text-center text-red-500 py-8 font-semibold">Por favor, selecciona dos jugadores diferentes</p>';
        return;
      }

      // Filtrar partidos entre estos dos jugadores
      const h2hMatches = matches.filter(m => 
        (m.player1 === player1 && m.player2 === player2) || 
        (m.player1 === player2 && m.player2 === player1)
      );

      if (h2hMatches.length === 0) {
        resultsDiv.innerHTML = '<p class="text-center text-gray-500 py-8">Estos jugadores aún no se han enfrentado</p>';
        return;
      }

      // Calcular estadísticas
      let p1Wins = 0, p2Wins = 0, draws = 0;
      let p1EloChange = 0, p2EloChange = 0;

      h2hMatches.forEach(m => {
        const isP1First = m.player1 === player1;
        
        if (m.result === 'win1') {
          if (isP1First) {
            p1Wins++;
            p1EloChange += m.elo1;
            p2EloChange += m.elo2;
          } else {
            p2Wins++;
            p1EloChange += m.elo2;
            p2EloChange += m.elo1;
          }
        } else if (m.result === 'win2') {
          if (isP1First) {
            p2Wins++;
            p1EloChange += m.elo1;
            p2EloChange += m.elo2;
          } else {
            p1Wins++;
            p1EloChange += m.elo2;
            p2EloChange += m.elo1;
          }
        } else if (m.result === 'draw') {
          draws++;
          if (isP1First) {
            p1EloChange += m.elo1;
            p2EloChange += m.elo2;
          } else {
            p1EloChange += m.elo2;
            p2EloChange += m.elo1;
          }
        }
      });

      const totalGames = h2hMatches.length;
      const p1Winrate = ((p1Wins / totalGames) * 100).toFixed(1);
      const p2Winrate = ((p2Wins / totalGames) * 100).toFixed(1);

      resultsDiv.innerHTML = `
        <!-- Resumen de Estadísticas -->
        <div class="bg-gradient-to-br from-purple-50 to-blue-50 rounded-xl p-6 mb-6 border-2 border-purple-200">
          <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">Resumen del Enfrentamiento</h3>
          
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <!-- Jugador 1 -->
            <div class="bg-white rounded-xl p-4 text-center shadow-md">
              <p class="font-bold text-lg text-gray-800 mb-2">${player1}</p>
              <p class="text-4xl font-bold text-green-600 mb-2">${p1Wins}</p>
              <p class="text-sm text-gray-600">Victorias (${p1Winrate}%)</p>
              <p class="text-lg font-semibold mt-2 ${p1EloChange >= 0 ? 'text-blue-600' : 'text-red-600'}">
                ${p1EloChange >= 0 ? '+' : ''}${p1EloChange} ELO
              </p>
            </div>

            <!-- Empates -->
            <div class="bg-white rounded-xl p-4 text-center shadow-md flex flex-col justify-center">
              <p class="text-4xl font-bold text-yellow-600 mb-2">${draws}</p>
              <p class="text-sm text-gray-600">Empates</p>
              <p class="text-lg font-semibold text-gray-700 mt-2">${totalGames} Partidos</p>
            </div>

            <!-- Jugador 2 -->
            <div class="bg-white rounded-xl p-4 text-center shadow-md">
              <p class="font-bold text-lg text-gray-800 mb-2">${player2}</p>
              <p class="text-4xl font-bold text-green-600 mb-2">${p2Wins}</p>
              <p class="text-sm text-gray-600">Victorias (${p2Winrate}%)</p>
              <p class="text-lg font-semibold mt-2 ${p2EloChange >= 0 ? 'text-blue-600' : 'text-red-600'}">
                ${p2EloChange >= 0 ? '+' : ''}${p2EloChange} ELO
              </p>
            </div>
          </div>

          <!-- Barra de progreso -->
          <div class="relative h-8 bg-gray-200 rounded-full overflow-hidden">
            <div class="absolute left-0 top-0 h-full bg-gradient-to-r from-green-500 to-green-600" style="width: ${p1Winrate}%"></div>
            <div class="absolute right-0 top-0 h-full bg-gradient-to-l from-blue-500 to-blue-600" style="width: ${p2Winrate}%"></div>
          </div>
        </div>

        <!-- Historial de Partidos -->
        <div>
          <h3 class="text-xl font-bold text-gray-800 mb-4">Historial de Partidos</h3>
          <div class="space-y-3">
            ${h2hMatches.map((m, i) => {
              const isP1First = m.player1 === player1;
              let winner = '';
              let bgColor = 'from-gray-50 to-blue-50';
              
              if (m.result === 'win1') {
                winner = m.player1;
                bgColor = winner === player1 ? 'from-green-50 to-green-100 border-green-300' : 'from-blue-50 to-blue-100 border-blue-300';
              } else if (m.result === 'win2') {
                winner = m.player2;
                bgColor = winner === player1 ? 'from-green-50 to-green-100 border-green-300' : 'from-blue-50 to-blue-100 border-blue-300';
              } else {
                bgColor = 'from-yellow-50 to-yellow-100 border-yellow-300';
              }

              const p1Elo = isP1First ? m.elo1 : m.elo2;
              const p2Elo = isP1First ? m.elo2 : m.elo1;
              
              return `
                <div class="flex items-center gap-4 p-4 bg-gradient-to-r ${bgColor} rounded-xl border-2 hover:shadow-md transition-shadow">
                  <div class="flex-shrink-0 w-8 h-8 bg-purple-600 text-white rounded-full flex items-center justify-center font-bold">
                    ${i + 1}
                  </div>
                  <div class="flex-grow">
                    <p class="text-gray-800">
                      <span class="${winner === player1 ? 'font-bold text-green-600' : ''}">${player1}</span>
                      vs
                      <span class="${winner === player2 ? 'font-bold text-green-600' : ''}">${player2}</span>
                    </p>
                    <p class="text-sm text-gray-600">
                      ${winner ? `Victoria de ${winner}` : 'Empate'}
                      <span class="ml-2">(${player1}: ${p1Elo >= 0 ? '+' : ''}${p1Elo}, ${player2}: ${p2Elo >= 0 ? '+' : ''}${p2Elo} ELO)</span>
                    </p>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      `;
    }

    // ========== HISTORICAL RANKING ==========
    function calculatePlayerStatsUpToMatch(matchIndex) {
      const players = {};
      
      // Inicializar jugadores
      initialPlayers.forEach(name => {
        players[name] = { name, elo: 0, w: 0, d: 0, l: 0 };
      });
      
      // Procesar partidos solo hasta el índice especificado
      matches.slice(0, matchIndex + 1).forEach(match => {
        const { player1, player2, result, elo1, elo2 } = match;
        
        if (!players[player1]) players[player1] = { name: player1, elo: 0, w: 0, d: 0, l: 0 };
        if (!players[player2]) players[player2] = { name: player2, elo: 0, w: 0, d: 0, l: 0 };
        
        players[player1].elo += elo1;
        players[player2].elo += elo2;
        
        if (result === 'win1') {
          players[player1].w++;
          players[player2].l++;
        } else if (result === 'win2') {
          players[player1].l++;
          players[player2].w++;
        } else if (result === 'draw') {
          players[player1].d++;
          players[player2].d++;
        }
      });
      
      return Object.values(players);
    }

    function initHistory() {
      // Configurar el slider
      const slider = document.getElementById('history-slider');
      slider.max = matches.length;
      document.getElementById('history-total-matches').textContent = matches.length;
      
      updateHistoricalRanking();
    }

    function updateHistoricalRanking() {
      const slider = document.getElementById('history-slider');
      const matchIndex = parseInt(slider.value) - 1;
      const matchNumber = matchIndex + 1;
      
      document.getElementById('history-match-number').textContent = matchNumber;
      
      // Mostrar info del partido
      const match = matches[matchIndex];
      let matchInfo = `<strong>Partido ${matchNumber}:</strong> `;
      if (match.result === 'win1') {
        matchInfo += `<span class="font-bold text-green-600">${match.player1}</span> venció a ${match.player2}`;
      } else if (match.result === 'win2') {
        matchInfo += `<span class="font-bold text-green-600">${match.player2}</span> venció a ${match.player1}`;
      } else {
        matchInfo += `${match.player1} empató con ${match.player2}`;
      }
      document.getElementById('history-match-info').innerHTML = matchInfo;
      
      // Calcular ranking hasta este partido
      const historicalPlayers = calculatePlayerStatsUpToMatch(matchIndex);
      
      const playersWithStats = historicalPlayers.map(p => {
        const played = p.w + p.d + p.l;
        const winrate = played > 0 ? ((p.w / played) * 100).toFixed(1) : 0;
        return {...p, played, winrate: parseFloat(winrate)};
      }).filter(p => p.played > 0); // Solo mostrar jugadores que han jugado
      
      playersWithStats.sort((a, b) => b.elo - a.elo);
      
      const tbody = document.getElementById('history-table');
      tbody.innerHTML = playersWithStats.map((p, i) => `
        <tr class="${getRankColor(i + 1)} transition-colors border-b border-gray-200 animate-fade-in-up stagger-${Math.min(i + 1, 9)}">
          <td class="px-6 py-4 font-bold text-gray-800">${i + 1}</td>
          <td class="px-6 py-4 font-semibold text-gray-800">${p.name}</td>
          <td class="px-6 py-4 text-center">
            <span class="inline-block bg-indigo-600 text-white px-3 py-1 rounded-full font-bold">${p.elo}</span>
          </td>
          <td class="px-6 py-4 text-center text-gray-700">${p.played}</td>
          <td class="px-6 py-4 text-center"><span class="text-green-600 font-bold">${p.w}</span></td>
          <td class="px-6 py-4 text-center"><span class="text-yellow-600 font-bold">${p.d}</span></td>
          <td class="px-6 py-4 text-center"><span class="text-red-600 font-bold">${p.l}</span></td>
          <td class="px-6 py-4 text-center">
            <span class="font-bold ${p.winrate >= 66.7 ? 'text-green-600' : p.winrate >= 33.3 ? 'text-yellow-600' : 'text-red-600'}">
              ${p.winrate}%
            </span>
          </td>
        </tr>
      `).join('');
    }
 
    renderTable(); 
    renderMatches(); 
    renderTop3();
    updateStats();
    initH2H();
    initHistory();
  </script> 
</body> 
</html>